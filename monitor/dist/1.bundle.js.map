{"version":3,"file":"1.bundle.js","sources":["webpack:///./app/js/api.js"],"sourcesContent":["var HOST = \"\";\r\nconst MQTT_HOST = \"202.118.26.129\";\r\nconst MQTT_PORT = 8083;\r\nvar UrlPath = {};\r\n\r\nvar debug = process.env.NODE_ENV === 'development';\r\n\r\nif(debug){\r\n  UrlPath = {\r\n    mapPoint1: \"api/mapPoint1.json\",\r\n    mapPoint2: \"api/mapPoint2.json\",\r\n    mapPoint3: \"api/mapPoint3.json\",\r\n    staffDetail: \"api/staffDetail.json\",\r\n    companyDetail: \"api/companyDetail.json\",\r\n    stationDetail: \"api/stationDetail.json\",\r\n  }\r\n}\r\nelse {\r\n  HOST = \"http://202.118.26.7:8080/PowerCloud/api\";\r\n  UrlPath = {\r\n    mapPoint: \"/electricitysubstation/getMapPoint\",\r\n    staffDetail: \"/electricitysubstation/getStationDetail\",\r\n    companyDetail: \"/customer/getCompanyDetail\",\r\n    stationDetail: \"/electricitysubstation/getStationDetail\",\r\n  }\r\n}\r\n\r\n// 封装一个get请求的方法\r\nfunction request(url, type, data) {\r\n  return new Promise(function(resolve, reject) {\r\n    var XHR = new XMLHttpRequest();\r\n\r\n\r\n    XHR.open(type, HOST + url, true);\r\n    XHR.setRequestHeader(\"Content-type\",\"application/json; charset=utf-8\");\r\n    XHR.send(data);\r\n\r\n    XHR.onreadystatechange = function() {\r\n      if (XHR.readyState == 4) {\r\n        if (XHR.status == 200) {\r\n          try {\r\n              var response = JSON.parse(XHR.responseText);\r\n              console.log(response)\r\n              if(response.succeeded) {\r\n                var r = typeof(response.data) == \"string\" ? JSON.parse(response.data) : response.data;\r\n                resolve(r);\r\n              }\r\n              else {\r\n                alert(\"请求数据错误\");\r\n                reject();\r\n              }\r\n          } catch (e) {\r\n              reject(e);\r\n          }\r\n        } else {\r\n          reject(new Error(XHR.statusText));\r\n        }\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nfunction initMqttConnection(callback, onMessageArrived) {\r\n  var client = new Paho.MQTT.Client(MQTT_HOST, Number(MQTT_PORT), \"webClient_\"+Date.now());//建立客户端实例\r\n  client.connect({onSuccess:onConnect});//连接服务器并注册连接成功处理事件\r\n  function onConnect() {\r\n      console.log(\"onConnected\");\r\n      // isMqttConnected = true;\r\n      callback(client);\r\n  }\r\n  client.onConnectionLost = onConnectionLost;//注册连接断开处理事件\r\n  client.onMessageArrived = onMessageArrived;//注册消息接收处理事件\r\n  function onConnectionLost(responseObject) {\r\n      if (responseObject.errorCode !== 0) {\r\n          console.log(\"onConnectionLost:\"+responseObject.errorMessage);\r\n          console.log(\"连接已断开\");\r\n          alert(\"Error：mqtt连接已断开\");\r\n       }\r\n  }\r\n}\r\n\r\nfunction mqttSubscribe(client,topic) {\r\n  if(client) {\r\n    console.log(topic)\r\n    client.subscribe(topic);//订阅主题\r\n  }\r\n}\r\n\r\nfunction mqttDisconnect(client) {\r\n  if(client) {\r\n    console.log(\"disconnect\")\r\n    client.disconnect();//订阅主题\r\n  }\r\n}\r\n\r\n\r\nfunction getMapPoint(type, callback) {\r\n\r\n  return new Promise(function(resolve,reject){\r\n    var path;\r\n    if(debug){\r\n      path = UrlPath[\"mapPoint\"+type];\r\n    }\r\n    else{\r\n      path = UrlPath.mapPoint;\r\n    }\r\n    request(path+\"?type=\"+type, \"POST\", null).then(function(r) {\r\n      resolve(r)\r\n    })\r\n  })\r\n}\r\n\r\n\r\nfunction getStaffDetail(id) {\r\n  return new Promise(function(resolve,reject){\r\n    request(UrlPath.staffDetail+\"?id=\"+id, \"POST\", null).then(function(r) {\r\n      resolve(r)\r\n    })\r\n  })\r\n}\r\n\r\nfunction getCompanyDetail(id) {\r\n  return new Promise(function(resolve,reject){\r\n    request(UrlPath.companyDetail+\"?id=\"+id, \"POST\", null).then(function(r) {\r\n      resolve(r)\r\n    })\r\n  })\r\n}\r\n\r\nfunction getStationDetail(id) {\r\n  return new Promise(function(resolve,reject){\r\n    request(UrlPath.stationDetail+\"?id=\"+id, \"POST\", null).then(function(r) {\r\n      resolve(r)\r\n    })\r\n  })\r\n}\r\n\r\nexport {\r\n  initMqttConnection,\r\n  mqttSubscribe,\r\n  mqttDisconnect,\r\n  getMapPoint,\r\n  getStaffDetail,\r\n  getCompanyDetail,\r\n  getStationDetail\r\n}\r\n\r\n"],"mappings":"AAAA","sourceRoot":""}